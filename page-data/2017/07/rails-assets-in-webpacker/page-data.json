{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017/07/rails-assets-in-webpacker","result":{"data":{"site":{"siteMetadata":{"title":"saitoxu.io","siteUrl":"https://saitoxu.io"}},"ogp":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAAjElEQVQoz82STQoDIQyF5/5HUVcuFNfeRdyIohvx7xWFllJm2llMaQOPhJiEj8QNF9v21YFjjIc/o+eeQ8LXgne2V7tLWGtFSgnWWhhjVhxjRM4Z3vul3vtnwvujcw6UUhBCoJQCYwxCCEgpobUG5xwhhPMDpy+lLIqpSdxaW4QzP+Pf7vDSK//dx74BXyBi+B0nsZEAAAAASUVORK5CYII=","width":1200,"height":630,"src":"/static/bb302f3ca7aabb14b0ae74df1c534526/e7e81/ogp.png","srcSet":"/static/bb302f3ca7aabb14b0ae74df1c534526/e7e81/ogp.png 1x"}}},"markdownRemark":{"id":"74630031-7385-5381-b4ab-32b8081b87fe","excerpt":"React × Rails の環境で、React から Rails の assets 内のリソースを使う方法について調べました。\nRails 5.1 から導入されたrails/webpackerを使っている前提とします。 環境 Rails 5.1.1 React 15.5.4 方法 webpacker の README…","html":"<p>React × Rails の環境で、React から Rails の assets 内のリソースを使う方法について調べました。\nRails 5.1 から導入された<a href=\"https://github.com/rails/webpacker\">rails/webpacker</a>を使っている前提とします。</p>\n<h2><strong>環境</strong></h2>\n<ul>\n<li>Rails 5.1.1</li>\n<li>React 15.5.4</li>\n</ul>\n<h2><strong>方法</strong></h2>\n<p>webpacker の README に書いてますが、\nassets のリソースを使いたい JS ファイルの拡張子を<code>.erb</code>にしておくと、\nerb の記法が使えるようになります（デフォルトで組み込まれている<code>rails-erb-loader</code>のおかげです）。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span># app<span class=\"token operator\">/</span>javascript<span class=\"token operator\">/</span>my_pack<span class=\"token operator\">/</span>example<span class=\"token punctuation\">.</span>js<span class=\"token punctuation\">.</span>erb <span class=\"token operator\">%</span><span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span> helpers <span class=\"token operator\">=</span> ActionController<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Base<span class=\"token punctuation\">.</span>helpers <span class=\"token operator\">%</span><span class=\"token operator\">></span>\n<span class=\"token keyword\">var</span> railsImagePath <span class=\"token operator\">=</span> <span class=\"token string\">\"&lt;%= helpers.image_path('rails.png') %>\"</span></code></pre></div>\n<p>というわけで、これを使って次のように assets のリソースを使えます。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// assets.js.erb</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span> helpers <span class=\"token operator\">=</span> ActionController<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Base<span class=\"token punctuation\">.</span>helpers <span class=\"token operator\">%</span><span class=\"token operator\">></span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> iconPath <span class=\"token operator\">=</span> <span class=\"token string\">\"&lt;%= helpers.image_path('icon.png') %>\"</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// SomeComponent.js</span>\n\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> iconPath <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./assets.js.erb\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SomeComponent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>img src<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>iconPath<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>プロダクション環境だと各リソースにダイジェストが付与されますが、\nそれもきちんと対応してくれます。</p>\n<p>ただ<code>xxx.js.erb</code>を直接あちこちで呼ぶのは気持ち悪いので、次のようにラップして使ってます。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// assets.js</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> iconPath <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"assets.js.erb\"</span>\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> iconPath <span class=\"token punctuation\">}</span></code></pre></div>\n<p>これで他のコンポーネントからは<code>import { iconPath } from './assets'</code>で呼べます。</p>\n<p>以上、小ネタでした。</p>","frontmatter":{"title":"ReactでRailsのassets内のリソースを使う","date":"July 31, 2017","tags":["Rails","React"],"ogp":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2017/07/rails-assets-in-webpacker","previous":{"fields":{"slug":"/2017/07/react-native-repro"},"frontmatter":{"title":"React Nativeにアプリ解析ツールのReproを導入してみる","tags":["React Native"]}},"next":{"fields":{"slug":"/2017/08/webview-ats-error"},"frontmatter":{"title":"ATSで許可されていないhttpなURLへの対処方法","tags":["React Native"]}}}}}