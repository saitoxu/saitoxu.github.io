{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017/09/react-native-d3js","result":{"data":{"site":{"siteMetadata":{"title":"saitoxu.io","siteUrl":"https://saitoxu.io"}},"ogp":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAAjElEQVQoz82STQoDIQyF5/5HUVcuFNfeRdyIohvx7xWFllJm2llMaQOPhJiEj8QNF9v21YFjjIc/o+eeQ8LXgne2V7tLWGtFSgnWWhhjVhxjRM4Z3vul3vtnwvujcw6UUhBCoJQCYwxCCEgpobUG5xwhhPMDpy+lLIqpSdxaW4QzP+Pf7vDSK//dx74BXyBi+B0nsZEAAAAASUVORK5CYII=","width":1200,"height":630,"src":"/static/bb302f3ca7aabb14b0ae74df1c534526/e7e81/ogp.png","srcSet":"/static/bb302f3ca7aabb14b0ae74df1c534526/e7e81/ogp.png 1x"}}},"markdownRemark":{"id":"679d5288-0011-56ce-b767-8d28c99169e9","excerpt":"JavaScript にはD3.jsというデータビジュアライゼーションのためのライブラリがありますが、\nこれを React Native で使ってみました。 D3.js は基本的に SVG(Scalable Vector Graphics)をいじってグラフを描画します。\nReact Native で SVG…","html":"<p>JavaScript には<a href=\"https://d3js.org/\">D3.js</a>というデータビジュアライゼーションのためのライブラリがありますが、\nこれを React Native で使ってみました。</p>\n<p>D3.js は基本的に SVG(Scalable Vector Graphics)をいじってグラフを描画します。\nReact Native で SVG を扱うには、公式で提供されている<a href=\"https://github.com/facebook/react-native/tree/master/Libraries/ART\">react-native-ART</a>か、\nreact-native コミュニティで開発されている<a href=\"https://github.com/react-native-community/react-native-svg\">react-native-svg</a>\nを使うと良いみたいです。</p>\n<p>※余談ですが、公式の ART ライブラリはなぜかドキュメントがなく使い方を学ぶのに不便だったりします。</p>\n<p>今回は D3.js と ART ライブラリを使ってグラフを描画しました。</p>\n<p>最終的にできたのがこちらです ↓</p>\n<p><img src=\"/df7ae7ebff0988d042c81d0800082419/2017-09-30-screenshot.gif\" alt=\"screenshot\"></p>\n<h2><strong>準備</strong></h2>\n<p>ART と D3.js をインストールします。\niOS では Xcode を開いて、<code>node_modules/react-native/Libraries/ART/ART.xcodeproj</code>を Libraries に追加し、\n<code>libART.a</code>を<code>Build Phases</code> -> <code>Link Binary With Libraries</code>で追加します。\nD3.js は<code>yarn add d3</code>で OK です。</p>\n<p>ここまでできたら使用するモジュールをインポートします。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">ART</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-native\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> d3scale <span class=\"token keyword\">from</span> <span class=\"token string\">\"d3-scale\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> d3shape <span class=\"token keyword\">from</span> <span class=\"token string\">\"d3-shape\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> d3Array <span class=\"token keyword\">from</span> <span class=\"token string\">\"d3-array\"</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> Surface<span class=\"token punctuation\">,</span> Group<span class=\"token punctuation\">,</span> Shape <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token constant\">ART</span>\n\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>今回はパイチャートを例に D3.js と ART の使い方を見ていきたいと思います。</p>\n<p>全体のコードは<a href=\"https://gist.github.com/saitoxu/674fa7d75d729e37319715b5bcc00ff8\">こちら</a>の gist に上げたので確認してみてください。</p>\n<h2><strong>パイチャートの描き方</strong></h2>\n<p>パイチャートを描くには、<code>Surface</code>コンポーネントの上に扇形の<code>Shape</code>コンポーネントを描いていくイメージになります。\nまず、次のようなデータを用意します。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> pieData <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> number<span class=\"token punctuation\">:</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Fun activities\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> number<span class=\"token punctuation\">:</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Dog\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> number<span class=\"token punctuation\">:</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Food\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> number<span class=\"token punctuation\">:</span> <span class=\"token number\">23</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Car\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> number<span class=\"token punctuation\">:</span> <span class=\"token number\">23</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Rent\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> number<span class=\"token punctuation\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Misc\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>次に、各データを表す扇のパスを取得します。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> arcs <span class=\"token operator\">=</span> d3shape<span class=\"token punctuation\">.</span><span class=\"token function\">pie</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> item<span class=\"token punctuation\">.</span>number<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>pieData<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> pieChart <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> paths<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span>\narcs<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">arc<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> d3shape\n    <span class=\"token punctuation\">.</span><span class=\"token function\">arc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">outerRadius</span><span class=\"token punctuation\">(</span><span class=\"token number\">180</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">padAngle</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.05</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">innerRadius</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>arc<span class=\"token punctuation\">)</span>\n  pieChart<span class=\"token punctuation\">.</span>paths<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> path <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>あとは、取得したパスを<code>Shape</code>コンポーネントに渡せば完成です！</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Surface</span></span> <span class=\"token attr-name\">width</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>width<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">height</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>width<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Group</span></span> <span class=\"token attr-name\">x</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>width <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">y</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>width <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>pieChart<span class=\"token punctuation\">.</span>paths<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Shape</span></span>\n          <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">pie_shape_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>index<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">fill</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>colors<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">stroke</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>colors<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">d</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">}</span></span>\n        <span class=\"token punctuation\">/></span></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Group</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Surface</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>折れ線グラフやエリアチャートも基本的にはいっしょで、\nD3.js の API を使ってパスを取得し、ART のコンポーネントに渡すだけです。</p>\n<h2><strong>おわりに</strong></h2>\n<p>以上、D3.js を使って React Native でグラフを描いてみました。</p>\n<p>自分は D3.js や SVG に詳しくなかったので最初苦労したんですが、\n慣れていれば React Native でも簡単にグラフを描けると思います。</p>\n<p>今回はやりませんでしたが、アニメーションなどもいけるみたいなので興味ある方はやってみてください！</p>\n<h4><strong>参考文献</strong></h4>\n<ul>\n<li><a href=\"https://medium.com/the-react-native-log/animated-charts-in-react-native-using-d3-and-art-21cd9ccf6c58\">Animated Charts in React Native using D3 and ART – The React Native Log – Medium</a></li>\n<li><a href=\"http://hswolff.com/blog/react-native-art-and-d3/\">React Native ART and D3</a></li>\n</ul>","frontmatter":{"title":"D3.js on React Nativeでグラフ描画","date":"September 30, 2017","tags":["JavaScript","React Native","D3.js"],"ogp":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADDUlEQVQozx2T3U9bBRjGjzH+GyZsu5O4C81uvPDCTC+MV0uMwJZoIsNElqgxfmxcmEWWwcImgzEGFSxsWkfbSSlQKMNSOqAFWjltV/p1+kVLe07pF123AsvPM97kvXhvnjzP78kr7CkFvDshYrsJZFlmKyHi9z1Gjv+Lpr+T5qYW2r78igmdnj0lSTS8hhQN4HG7KVeeUdp/RsDtwf/AgO9aL8JhpYjW9QedyxruOib5YVrLL/P/8GnrBV5/7Q0EQeBSezsvjw5RcjKhUIDhIQ093T3cH3/A1KSJKaOO9f8cFOQ8Qn1ZS2rhHlrbGP2q4G27niuWcd483Xgs9mq7u7p4NfmcQiIUZWhggMGBQW739jE6rGFKr8M6bcS96kDYMOmQFg24PSu4gh6M6w42oxFmZ2c58+4Zzp79CPvquhrtgFB8m9auDtp+usrYiBbrnBWzycyYVkvHlQ4+bz6PEMrVSGeybHlEAuI23kCYQqHIYf1QZZYnmMjijhWwOKN8vPg+wl/nEM5P8v13ZmbME8zOzNGrOn2rsZGGhpMIst9PPi6Sjqfxe30kYzGyuznKpYoqesBWOI0YU4hnilystPA2D3nHCJrfFVxOGwtzNm503+BkwylOnTiBsKTYuZocwp6NEgun8PlCRIKh4wLCYYlgSKJSrVHff068FsVSj9H7p4E7P7cjuhZxupfRTFyn9VIzTZ81Idxdeci3+lFabvbzeMGD0xlEdD5Rua0xbtlk1LyCZztJLp1GzmZJeDf5te1DOr/4gOvfnOPv+Tvct/ahtfSwm08i2JeMjI70cfPWbzjsIq71MF7nMkurLoZNa4yYVvFL2eOWq88PyKQkOto+4cfm97h1+QIbTguiVYfbNkE2LSGkduLY7FbEbUnlVEKKZVFkhVK5SiAcY8Xn4UW9TkSOU65VVbZlNp7YmNcPspOMUFdvaXqGrzsNDBkuI+wqRSKpPFK6iKSCL1ZecHT0klrtgEK1gvmplVBGYlKcR96XyckZNfrOseOy+iX1aolHT/c4fc3GI884/wNz/biIOQ0i4QAAAABJRU5ErkJggg==","width":1200,"height":630,"src":"/static/1c90a3bf82b1a4933bc697d1d102af73/e7e81/2017-09-30-ogp.png","srcSet":"/static/1c90a3bf82b1a4933bc697d1d102af73/e7e81/2017-09-30-ogp.png 1x"}}}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2017/09/react-native-d3js","previous":{"fields":{"slug":"/2017/09/sendbird-sample"},"frontmatter":{"title":"手軽にチャット機能を作れるSendBirdを試してみた","tags":["JavaScript","React Native","SendBird"]}},"next":{"fields":{"slug":"/2017/10/blog-first-anniversary"},"frontmatter":{"title":"ブログを続けて1年が経ちました","tags":["Daily"]}}}}}