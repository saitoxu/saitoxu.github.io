{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017/01/vagrant-sync-folder","result":{"data":{"site":{"siteMetadata":{"title":"saitoxu.io","siteUrl":"https://saitoxu.io"}},"ogp":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAAjElEQVQoz82STQoDIQyF5/5HUVcuFNfeRdyIohvx7xWFllJm2llMaQOPhJiEj8QNF9v21YFjjIc/o+eeQ8LXgne2V7tLWGtFSgnWWhhjVhxjRM4Z3vul3vtnwvujcw6UUhBCoJQCYwxCCEgpobUG5xwhhPMDpy+lLIqpSdxaW4QzP+Pf7vDSK//dx74BXyBi+B0nsZEAAAAASUVORK5CYII=","width":1200,"height":630,"src":"/static/bb302f3ca7aabb14b0ae74df1c534526/e7e81/ogp.png","srcSet":"/static/bb302f3ca7aabb14b0ae74df1c534526/e7e81/ogp.png 1x"}}},"markdownRemark":{"id":"592868d1-3a4d-5a2e-9628-a2d089210f87","excerpt":"Vagrant の共有フォルダを使っているとき、\nホストからのファイルの変更が検知されない問題があり、\n簡単なシェルスクリプトを書いて対応しました。 ファイル変更が検知されない このブログは Jekyll を使って書いていて、\nVagrant の共有フォルダを使ってホスト側の Mac…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c3e310e50e38acec58caedb5331643bb/6e525/2017-01-12-vagrant.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAgAF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgED/9oADAMBAAIQAxAAAAHYCbKqzv8A/8QAGBAAAgMAAAAAAAAAAAAAAAAAAQIDIEH/2gAIAQEAAQUCyNi1f//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABgQAAIDAAAAAAAAAAAAAAAAAAABESAh/9oACAEBAAY/AsJdf//EABkQAQACAwAAAAAAAAAAAAAAAAEAERAxQf/aAAgBAQABPyFu3XJZhRrBADWP/9oADAMBAAIAAwAAABBjD//EABcRAQADAAAAAAAAAAAAAAAAAAEQESH/2gAIAQMBAT8QTbj/xAAWEQEBAQAAAAAAAAAAAAAAAAARAAH/2gAIAQIBAT8Q0Iv/xAAaEAACAwEBAAAAAAAAAAAAAAABEQAhMRBB/9oACAEBAAE/ECuBXWODFOgCt+xwHRyZhPn/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Vagrant\"\n        title=\"Vagrant\"\n        src=\"/static/c3e310e50e38acec58caedb5331643bb/88218/2017-01-12-vagrant.jpg\"\n        srcset=\"/static/c3e310e50e38acec58caedb5331643bb/7237a/2017-01-12-vagrant.jpg 148w,\n/static/c3e310e50e38acec58caedb5331643bb/0cfdf/2017-01-12-vagrant.jpg 295w,\n/static/c3e310e50e38acec58caedb5331643bb/88218/2017-01-12-vagrant.jpg 590w,\n/static/c3e310e50e38acec58caedb5331643bb/77d57/2017-01-12-vagrant.jpg 885w,\n/static/c3e310e50e38acec58caedb5331643bb/5a917/2017-01-12-vagrant.jpg 1180w,\n/static/c3e310e50e38acec58caedb5331643bb/6e525/2017-01-12-vagrant.jpg 1200w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Vagrant の共有フォルダを使っているとき、\nホストからのファイルの変更が検知されない問題があり、\n簡単なシェルスクリプトを書いて対応しました。</p>\n<h1>ファイル変更が検知されない</h1>\n<p>このブログは Jekyll を使って書いていて、\nVagrant の共有フォルダを使ってホスト側の Mac で記事を書いて\nゲスト側の Linux で Jekyll を立ち上げています。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ bundle <span class=\"token builtin class-name\">exec</span> jekyll serve --host<span class=\"token operator\">=</span><span class=\"token number\">0.0</span>.0.0 <span class=\"token comment\"># 変更があれば自動でビルドしてくれるはず</span></code></pre></div>\n<p>同じ OS 上で編集している場合は上記で問題ないのですが、\nVagrant の共有フォルダ上ではファイル変更が検知されず、自動でビルドしてくれません。\nこれだと自分でビルドしなければならず、かなり効率が落ちてしまいます。</p>\n<h1>よくある回避方法</h1>\n<p>一応回避方法があって、Jekyll を立ち上げるときに<code>--force_polling</code>というオプションを\nつけてあげれば自動でビルドされるようになります。</p>\n<p>そもそも共有フォルダ（NFS）上でファイルの変更を監視する inotify が効かないのが問題なのですが、\n<code>--force_polling</code>は inotify を使わず適当な間隔で自動ビルドしてくれるようになります。</p>\n<p>自分の環境では体感 30 秒くらいで変更が検知されます。\nただ一回編集するごとに 30 秒も待てないので、どうしようか考えました。</p>\n<h1>touch コマンドでファイル変更検知</h1>\n<p>ファイル自体は変更されてるようなので、\ntouch コマンドを使えば変更検知されるんじゃないかと試したところ、\nうまいこと inotify が変更検知し、Jekyll の自動ビルドが走りました。</p>\n<p>以下のようなスクリプトを作って走らせておくと\nローカルで開発しているかのように自動ビルドが走ります。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n\n<span class=\"token assign-left variable\">BASE_DIR</span><span class=\"token operator\">=</span>/home/vagrant/yoursite\n<span class=\"token assign-left variable\">LAYOUTS</span><span class=\"token operator\">=</span><span class=\"token variable\">${BASE_DIR}</span>/_layouts\n<span class=\"token assign-left variable\">POSTS</span><span class=\"token operator\">=</span><span class=\"token variable\">${BASE_DIR}</span>/_posts\n<span class=\"token assign-left variable\">CSS</span><span class=\"token operator\">=</span><span class=\"token variable\">${BASE_DIR}</span>/css\n<span class=\"token assign-left variable\">IMAGES</span><span class=\"token operator\">=</span><span class=\"token variable\">${BASE_DIR}</span>/images\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Watching...\"</span>\n<span class=\"token keyword\">while</span> <span class=\"token builtin class-name\">:</span>\n<span class=\"token keyword\">do</span>\n  <span class=\"token function\">touch</span> <span class=\"token variable\">${BASE_DIR}</span> <span class=\"token variable\">${LAYOUTS}</span> <span class=\"token variable\">${POSTS}</span> <span class=\"token variable\">${CSS}</span> <span class=\"token variable\">${IMAGES}</span>\n  usleep <span class=\"token number\">200000</span> <span class=\"token comment\"># 0.2秒間隔</span>\n<span class=\"token keyword\">done</span></code></pre></div>\n<h1>おわりに</h1>\n<p>Vagrant で共有フォルダ上のファイル変更が検知されない問題について書きました。</p>\n<p>今回は Jekyll を例に説明しましたが、Jekyll に限らずホスト側で編集・ゲスト側で\n変更検知 → タスクを走らせるという場面は多いと思うので、良ければ試してみてください。</p>","frontmatter":{"title":"Vagrantの共有フォルダ上でファイル変更が検知されない問題に対応する","date":"January 12, 2017","tags":["Vagrant","Shell","Jekyll"],"ogp":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAgAF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgED/9oADAMBAAIQAxAAAAHYCbKqzv8A/8QAFxABAAMAAAAAAAAAAAAAAAAAAgADIP/aAAgBAQABBQKVpLP/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAAICH/2gAIAQEABj8CKv8A/8QAGhABAAIDAQAAAAAAAAAAAAAAAQAQESFBgf/aAAgBAQABPyHmog44DXtEAK//2gAMAwEAAgADAAAAECMP/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAh/9oACAEDAQE/EE2f/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAERMf/aAAgBAgEBPxCcU//EABoQAQADAQEBAAAAAAAAAAAAAAEAETEhQYH/2gAIAQEAAT8QFUKmuMQRyq318gzqZhUJ/9k=","width":1200,"height":630,"src":"/static/c3e310e50e38acec58caedb5331643bb/6665b/2017-01-12-vagrant.jpg","srcSet":"/static/c3e310e50e38acec58caedb5331643bb/6665b/2017-01-12-vagrant.jpg 1x"}}}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2017/01/vagrant-sync-folder","previous":{"fields":{"slug":"/2017/01/convolution-and-pooling"},"frontmatter":{"title":"Easy Implementation of Convolution and Pooling Layer in Deep Learning","tags":["JavaScript","Machine Learning","Deep Learning"]}},"next":{"fields":{"slug":"/2017/02/artificial-intelligence"},"frontmatter":{"title":"人工知能系スタートアップ約200社まとめてみた","tags":["Book","AI","Startup"]}}}}}