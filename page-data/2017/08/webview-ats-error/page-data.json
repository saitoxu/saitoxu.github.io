{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017/08/webview-ats-error","result":{"data":{"site":{"siteMetadata":{"title":"saitoxu.io","siteUrl":"https://saitoxu.io"}},"ogp":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAAjElEQVQoz82STQoDIQyF5/5HUVcuFNfeRdyIohvx7xWFllJm2llMaQOPhJiEj8QNF9v21YFjjIc/o+eeQ8LXgne2V7tLWGtFSgnWWhhjVhxjRM4Z3vul3vtnwvujcw6UUhBCoJQCYwxCCEgpobUG5xwhhPMDpy+lLIqpSdxaW4QzP+Pf7vDSK//dx74BXyBi+B0nsZEAAAAASUVORK5CYII=","width":1200,"height":630,"src":"/static/bb302f3ca7aabb14b0ae74df1c534526/e7e81/ogp.png","srcSet":"/static/bb302f3ca7aabb14b0ae74df1c534526/e7e81/ogp.png 1x"}}},"markdownRemark":{"id":"e0b5622b-5e00-50d4-8400-4f0ef6b8f699","excerpt":"前置き iOS では ATS(App Transport Security)で許可されていない\nhttp リソースにはアクセスできない仕組みになっており、\nReact Native でもそれは変わりません。 自身が管理しているドメインであれば https にする、または\n特定の限られた http…","html":"<h2><strong>前置き</strong></h2>\n<p>iOS では ATS(App Transport Security)で許可されていない\nhttp リソースにはアクセスできない仕組みになっており、\nReact Native でもそれは変わりません。</p>\n<p>自身が管理しているドメインであれば https にする、または\n特定の限られた http リソース（かつ信頼できる）であれば ATS を許可する、\nなどやり方はありますが、\n今回不特定の http リソースにアクセスする方法を実現したかったのでちょっと調べました。</p>\n<p>環境は React Native 0.44、iOS での利用を想定してます。</p>\n<h2><strong>方法</strong></h2>\n<p><code>WebView</code>に<code>onError</code>という props を渡すことで、\nネットワークに繋がっていないなどのエラー時に任意の関数を呼べます。</p>\n<p>関数の引数としてエラー情報が入った<code>Proxy</code>オブジェクトが返ってくるので、\nそれを使って外部ブラウザで開いたりすると良さそうです。</p>\n<p><div id=\"gist73890291\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-webviewsample-js\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-javascript \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-webviewsample-js-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-webviewsample-js-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-c>// 外部ブラウザで開く例</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-webviewsample-js-LC2\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-webviewsample-js-LC3\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>import</span> <span class=pl-v>React</span><span class=pl-kos>,</span> <span class=pl-kos>{</span> <span class=pl-v>Component</span> <span class=pl-kos>}</span> <span class=pl-k>from</span> <span class=pl-s>&#39;react&#39;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-webviewsample-js-LC4\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>import</span> <span class=pl-kos>{</span> <span class=pl-v>Alert</span><span class=pl-kos>,</span> <span class=pl-v>Linking</span><span class=pl-kos>,</span> <span class=pl-v>WebView</span> <span class=pl-kos>}</span> <span class=pl-k>from</span> <span class=pl-s>&#39;react-native&#39;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-webviewsample-js-LC5\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-webviewsample-js-LC6\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>const</span> <span class=pl-c1>ATS_ERROR_CODE</span> <span class=pl-c1>=</span> <span class=pl-c1>-</span><span class=pl-c1>1022</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-webviewsample-js-LC7\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-webviewsample-js-LC8\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>export</span> <span class=pl-k>default</span> <span class=pl-k>class</span> <span class=pl-v>WebViewSample</span> <span class=pl-k>extends</span> <span class=pl-v>Component</span> <span class=pl-kos>{</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-webviewsample-js-LC9\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-en>constructor</span><span class=pl-kos>(</span><span class=pl-s1>props</span><span class=pl-kos>)</span> <span class=pl-kos>{</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-webviewsample-js-LC10\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-smi>super</span><span class=pl-kos>(</span><span class=pl-s1>props</span><span class=pl-kos>)</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-webviewsample-js-LC11\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-smi>this</span><span class=pl-kos>.</span><span class=pl-c1>handleError</span> <span class=pl-c1>=</span> <span class=pl-smi>this</span><span class=pl-kos>.</span><span class=pl-c1>handleError</span><span class=pl-kos>.</span><span class=pl-en>bind</span><span class=pl-kos>(</span><span class=pl-smi>this</span><span class=pl-kos>)</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-webviewsample-js-LC12\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-smi>this</span><span class=pl-kos>.</span><span class=pl-c1>openUrl</span> <span class=pl-c1>=</span> <span class=pl-smi>this</span><span class=pl-kos>.</span><span class=pl-c1>openUrl</span><span class=pl-kos>.</span><span class=pl-en>bind</span><span class=pl-kos>(</span><span class=pl-smi>this</span><span class=pl-kos>)</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-webviewsample-js-LC13\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-kos>}</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-webviewsample-js-LC14\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-webviewsample-js-LC15\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-en>handleError</span><span class=pl-kos>(</span><span class=pl-s1>proxy</span><span class=pl-kos>)</span> <span class=pl-kos>{</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-webviewsample-js-LC16\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>const</span> <span class=pl-kos>{</span> code <span class=pl-kos>}</span> <span class=pl-c1>=</span> <span class=pl-s1>proxy</span><span class=pl-kos>.</span><span class=pl-c1>nativeEvent</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-webviewsample-js-LC17\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>const</span> <span class=pl-kos>{</span> url <span class=pl-kos>}</span> <span class=pl-c1>=</span> <span class=pl-smi>this</span><span class=pl-kos>.</span><span class=pl-c1>props</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-webviewsample-js-LC18\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>if</span> <span class=pl-kos>(</span><span class=pl-s1>code</span> <span class=pl-c1>===</span> <span class=pl-c1>ATS_ERROR_CODE</span><span class=pl-kos>)</span> <span class=pl-kos>{</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-webviewsample-js-LC19\" class=\"blob-code blob-code-inner js-file-line\">      <span class=pl-smi>this</span><span class=pl-kos>.</span><span class=pl-en>openUrl</span><span class=pl-kos>(</span><span class=pl-s1>url</span><span class=pl-kos>)</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-webviewsample-js-LC20\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-kos>}</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-webviewsample-js-LC21\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-kos>}</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-webviewsample-js-LC22\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-webviewsample-js-LC23\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-en>openUrl</span><span class=pl-kos>(</span><span class=pl-s1>url</span><span class=pl-kos>)</span> <span class=pl-kos>{</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-webviewsample-js-LC24\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-v>Linking</span><span class=pl-kos>.</span><span class=pl-en>canOpenURL</span><span class=pl-kos>(</span><span class=pl-s1>url</span><span class=pl-kos>)</span><span class=pl-kos>.</span><span class=pl-en>then</span><span class=pl-kos>(</span><span class=pl-s1>supported</span> <span class=pl-c1>=&gt;</span> <span class=pl-kos>{</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-webviewsample-js-LC25\" class=\"blob-code blob-code-inner js-file-line\">      <span class=pl-k>if</span> <span class=pl-kos>(</span><span class=pl-s1>supported</span><span class=pl-kos>)</span> <span class=pl-kos>{</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-webviewsample-js-LC26\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-v>Linking</span><span class=pl-kos>.</span><span class=pl-en>openURL</span><span class=pl-kos>(</span><span class=pl-s1>url</span><span class=pl-kos>)</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-webviewsample-js-LC27\" class=\"blob-code blob-code-inner js-file-line\">      <span class=pl-kos>}</span> <span class=pl-k>else</span> <span class=pl-kos>{</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-webviewsample-js-LC28\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-v>Alert</span><span class=pl-kos>.</span><span class=pl-en>alert</span><span class=pl-kos>(</span><span class=pl-s>&#39;URLを開けませんでした。&#39;</span><span class=pl-kos>)</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-webviewsample-js-LC29\" class=\"blob-code blob-code-inner js-file-line\">      <span class=pl-kos>}</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L30\" class=\"blob-num js-line-number\" data-line-number=\"30\"></td>\n        <td id=\"file-webviewsample-js-LC30\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-kos>}</span><span class=pl-kos>)</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L31\" class=\"blob-num js-line-number\" data-line-number=\"31\"></td>\n        <td id=\"file-webviewsample-js-LC31\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-kos>}</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L32\" class=\"blob-num js-line-number\" data-line-number=\"32\"></td>\n        <td id=\"file-webviewsample-js-LC32\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L33\" class=\"blob-num js-line-number\" data-line-number=\"33\"></td>\n        <td id=\"file-webviewsample-js-LC33\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-en>render</span><span class=pl-kos>(</span><span class=pl-kos>)</span> <span class=pl-kos>{</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L34\" class=\"blob-num js-line-number\" data-line-number=\"34\"></td>\n        <td id=\"file-webviewsample-js-LC34\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>const</span> <span class=pl-kos>{</span> url <span class=pl-kos>}</span> <span class=pl-c1>=</span> <span class=pl-smi>this</span><span class=pl-kos>.</span><span class=pl-c1>props</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L35\" class=\"blob-num js-line-number\" data-line-number=\"35\"></td>\n        <td id=\"file-webviewsample-js-LC35\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>return</span> <span class=pl-c1>&lt;</span><span class=pl-ent>WebView</span> <span class=pl-c1>source</span><span class=pl-c1>=</span><span class=pl-kos>{</span><span class=pl-kos>{</span> <span class=pl-c1>uri</span>: <span class=pl-s1>url</span> <span class=pl-kos>}</span><span class=pl-kos>}</span> <span class=pl-c1>startInLoadingState</span> <span class=pl-c1>onError</span><span class=pl-c1>=</span><span class=pl-kos>{</span><span class=pl-smi>this</span><span class=pl-kos>.</span><span class=pl-c1>handleError</span><span class=pl-kos>}</span> /<span class=pl-c1>&gt;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L36\" class=\"blob-num js-line-number\" data-line-number=\"36\"></td>\n        <td id=\"file-webviewsample-js-LC36\" class=\"blob-code blob-code-inner js-file-line\">  <span class=pl-kos>}</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-webviewsample-js-L37\" class=\"blob-num js-line-number\" data-line-number=\"37\"></td>\n        <td id=\"file-webviewsample-js-LC37\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-kos>}</span></td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/saitoxu/19f31c67c7aff98fc56f9bd24c070cb9/raw/6e39227c5106210377e237aa2d590204e0515b8d/WebViewSample.js\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/saitoxu/19f31c67c7aff98fc56f9bd24c070cb9#file-webviewsample-js\">WebViewSample.js</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<h2><strong>おわりに</strong></h2>\n<p>外部ブラウザで開きたくないという場合は、\n今回試してはいないですが\n<a href=\"https://github.com/naoufal/react-native-safari-view\">naoufal/react-native-safari-view</a>\nも使えそうです（しばらく更新されていないのは気がかりですが）。</p>","frontmatter":{"title":"ATSで許可されていないhttpなURLへの対処方法","date":"August 06, 2017","tags":["React Native"],"ogp":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2017/08/webview-ats-error","previous":{"fields":{"slug":"/2017/07/rails-assets-in-webpacker"},"frontmatter":{"title":"ReactでRailsのassets内のリソースを使う","tags":["Rails","React"]}},"next":{"fields":{"slug":"/2017/08/rails-and-ses"},"frontmatter":{"title":"RailsとAmazon SESを使ってメールを確実に届けるには","tags":["Rails","Amazon SES"]}}}}}