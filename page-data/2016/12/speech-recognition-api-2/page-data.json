{"componentChunkName":"component---src-templates-blog-post-js","path":"/2016/12/speech-recognition-api-2","result":{"data":{"site":{"siteMetadata":{"title":"saitoxu.io","siteUrl":"https://saitoxu.io"}},"ogp":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAAjElEQVQoz82STQoDIQyF5/5HUVcuFNfeRdyIohvx7xWFllJm2llMaQOPhJiEj8QNF9v21YFjjIc/o+eeQ8LXgne2V7tLWGtFSgnWWhhjVhxjRM4Z3vul3vtnwvujcw6UUhBCoJQCYwxCCEgpobUG5xwhhPMDpy+lLIqpSdxaW4QzP+Pf7vDSK//dx74BXyBi+B0nsZEAAAAASUVORK5CYII=","width":1200,"height":630,"src":"/static/bb302f3ca7aabb14b0ae74df1c534526/e7e81/ogp.png","srcSet":"/static/bb302f3ca7aabb14b0ae74df1c534526/e7e81/ogp.png 1x"}}},"markdownRemark":{"id":"8d9eca16-1335-56d8-8e73-480774a97b7f","excerpt":"This is continued article of the previous post. Step 5 Add a label and a button to first view on storyboard.  Step 6 Next, load required modules and create a…","html":"<p>This is continued article of <a href=\"/2016/12/speech-recognition-api\">the previous post</a>.</p>\n<h4><strong>Step 5</strong></h4>\n<p>Add a label and a button to first view on storyboard.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 280px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/685da85db393d97fe8ef459ea2e1771f/e07ab/2016-12-07-storyboard.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 186.78571428571428%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAlCAIAAADNzV5SAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvklEQVRIx+2VyU7DMBCG8wa8HW/Aq3BC4sYRCXGACyBxAQRCbVEBIWiBtmyFkG6kULWFpGkWO/6x3RAB6ZKAxInRryzOfJ6ZOJ4o9LsR6sPr6aTf9Ho9Yhlet+V1XiiDeCQNgKZplUpFYQPz/UADA4JjeMFCR5/DqVQqk8ko+IUJmHVMqDqeX1FrMceLg/EMeZ4Cds7L1sKmubxrLW6TZhsugeWg706QiHyv+2dlr6CSS9UrPLLrKm5qE3RXx7mKB11BqQqjn7hcjpSqCq5rMGxxz2JLwDYHJWwmj8yRf/gHMF90004O2xxUcKmh0RbfI1/3r2JS0XHhzJGCpuBJnHBbH/4ZDh3ng0UNekcZvW9Q7kJ3xm9JudOj4lvuzWb9N1dMg6E+GN0MqOgYbC2LuXUQOrIZDDcJ0KU9OjXtbmSDSuLC0tW9b1gz83QlHeYSDx7UCXi1F3d2NRp2EvwRzd468S/UcLrYsPSmhuUcXwW1fOJjtV7u7kfCjoWlK3vu4vAKeZUdlLBzhp0cLh7DWSbATqVp7J329nPmUVEonTePiz4hsdLmE/DlJjJt+qEkNUdbZ6IXNu5f9Q//FfwOd8558lUNhjgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Storyboard\"\n        title=\"Storyboard\"\n        src=\"/static/685da85db393d97fe8ef459ea2e1771f/e07ab/2016-12-07-storyboard.png\"\n        srcset=\"/static/685da85db393d97fe8ef459ea2e1771f/00d96/2016-12-07-storyboard.png 148w,\n/static/685da85db393d97fe8ef459ea2e1771f/e07ab/2016-12-07-storyboard.png 280w\"\n        sizes=\"(max-width: 280px) 100vw, 280px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4><strong>Step 6</strong></h4>\n<p>Next, load required modules and create a method called when tapping the button.</p>\n<p>Please choose a language which you want to recognize as locale when initializing <code>SFSpeechRecognizer</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">import</span> <span class=\"token builtin\">UIKit</span>\n<span class=\"token keyword\">import</span> <span class=\"token builtin\">Speech</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ViewController</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIViewController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> speechRecognizer <span class=\"token operator\">=</span> <span class=\"token function\">SFSpeechRecognizer</span><span class=\"token punctuation\">(</span>locale<span class=\"token punctuation\">:</span> <span class=\"token function\">Locale</span><span class=\"token punctuation\">(</span>identifier<span class=\"token punctuation\">:</span> <span class=\"token string\">\"ja-JP\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> recognitionRequest<span class=\"token punctuation\">:</span> <span class=\"token builtin\">SFSpeechAudioBufferRecognitionRequest</span><span class=\"token operator\">?</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> recognitionTask<span class=\"token punctuation\">:</span> <span class=\"token builtin\">SFSpeechRecognitionTask</span><span class=\"token operator\">?</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> audioEngine <span class=\"token operator\">=</span> <span class=\"token function\">AVAudioEngine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token atrule\">@IBOutlet</span> <span class=\"token keyword\">weak</span> <span class=\"token keyword\">var</span> label<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UILabel</span><span class=\"token operator\">!</span>\n    <span class=\"token atrule\">@IBOutlet</span> <span class=\"token keyword\">weak</span> <span class=\"token keyword\">var</span> startBtn<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIButton</span><span class=\"token operator\">!</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        startBtn<span class=\"token punctuation\">.</span>isEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// Dispose of any resources that can be recreated.</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidAppear</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> animated<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidAppear</span><span class=\"token punctuation\">(</span>animated<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token atrule\">@IBAction</span> <span class=\"token keyword\">func</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> sender<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// TODO</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4><strong>Step 7</strong></h4>\n<p>Add extension of <code>SFSpeechRecognizerDelegate</code> to <code>ViewController</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">ViewController</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">SFSpeechRecognizerDelegate</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">speechRecognizer</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> speechRecognizer<span class=\"token punctuation\">:</span> <span class=\"token builtin\">SFSpeechRecognizer</span><span class=\"token punctuation\">,</span> availabilityDidChange available<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> available <span class=\"token punctuation\">{</span>\n            startBtn<span class=\"token punctuation\">.</span>isEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n            startBtn<span class=\"token punctuation\">.</span><span class=\"token function\">setTitle</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Start\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            startBtn<span class=\"token punctuation\">.</span>isEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n            startBtn<span class=\"token punctuation\">.</span><span class=\"token function\">setTitle</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Clear\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>disabled<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And make the initial state of button disabled.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ViewController</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIViewController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        speechRecognizer<span class=\"token punctuation\">.</span>delegate <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span>\n        startButton<span class=\"token punctuation\">.</span>isEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4><strong>Step 8</strong></h4>\n<p>To use speech recognition, the app needs user’s permission.</p>\n<p>So add process to get the permission and call it when the view is appeared.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ViewController</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIViewController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidAppear</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> animated<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidAppear</span><span class=\"token punctuation\">(</span>animated<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">requestRecognizerAuthorization</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">func</span> <span class=\"token function\">requestRecognizerAuthorization</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin\">SFSpeechRecognizer</span><span class=\"token punctuation\">.</span>requestAuthorization <span class=\"token punctuation\">{</span> authStatus <span class=\"token keyword\">in</span>\n            <span class=\"token builtin\">OperationQueue</span><span class=\"token punctuation\">.</span>main<span class=\"token punctuation\">.</span>addOperation <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">weak</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">in</span>\n                <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> `<span class=\"token keyword\">self</span>` <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">}</span>\n\n                <span class=\"token keyword\">switch</span> authStatus <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>authorized<span class=\"token punctuation\">:</span>\n                    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>startBtn<span class=\"token punctuation\">.</span>isEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n\n                <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>denied<span class=\"token punctuation\">:</span>\n                    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>startBtn<span class=\"token punctuation\">.</span>isEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n                    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>startBtn<span class=\"token punctuation\">.</span><span class=\"token function\">setTitle</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Access denied\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>disabled<span class=\"token punctuation\">)</span>\n\n                <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>restricted<span class=\"token punctuation\">:</span>\n                    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>startBtn<span class=\"token punctuation\">.</span>isEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n                    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>startBtn<span class=\"token punctuation\">.</span><span class=\"token function\">setTitle</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Access restricted\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>disabled<span class=\"token punctuation\">)</span>\n\n                <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>notDetermined<span class=\"token punctuation\">:</span>\n                    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>startBtn<span class=\"token punctuation\">.</span>isEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n                    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>startBtn<span class=\"token punctuation\">.</span><span class=\"token function\">setTitle</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"No permission\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>disabled<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>Next, I’ll write the main process to recognize speech when tapping the <code>start</code> button.</p>","frontmatter":{"title":"Speech Recognition API (2)","date":"December 07, 2016","tags":["Swift","iOS","Xcode"],"ogp":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2016/12/speech-recognition-api-2","previous":{"fields":{"slug":"/2016/12/speech-recognition-api"},"frontmatter":{"title":"Speech Recognition API (1)","tags":["Swift - iOS - Xcode"]}},"next":{"fields":{"slug":"/2016/12/speech-recognition-api-3"},"frontmatter":{"title":"Speech Recognition API (3)","tags":["Swift","iOS","Xcode"]}}}}}