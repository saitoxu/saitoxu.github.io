{"componentChunkName":"component---src-templates-blog-post-js","path":"/2016/11/how-to-use-opencv-in-swift-2","result":{"data":{"site":{"siteMetadata":{"title":"saitoxu.io","siteUrl":"https://saitoxu.io"}},"ogp":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAAjElEQVQoz82STQoDIQyF5/5HUVcuFNfeRdyIohvx7xWFllJm2llMaQOPhJiEj8QNF9v21YFjjIc/o+eeQ8LXgne2V7tLWGtFSgnWWhhjVhxjRM4Z3vul3vtnwvujcw6UUhBCoJQCYwxCCEgpobUG5xwhhPMDpy+lLIqpSdxaW4QzP+Pf7vDSK//dx74BXyBi+B0nsZEAAAAASUVORK5CYII=","width":1200,"height":630,"src":"/static/bb302f3ca7aabb14b0ae74df1c534526/e7e81/ogp.png","srcSet":"/static/bb302f3ca7aabb14b0ae74df1c534526/e7e81/ogp.png 1x"}}},"markdownRemark":{"id":"dac0c5d1-e27b-5589-b177-a82850a9a355","excerpt":"This is a continuation of my previous post. Step 5 Create a header file to use OpenCV. Step 6 Next, prepare the content of defined method. To use OpenCV, we…","html":"<p>This is a continuation of <a href=\"/2016/11/how-to-use-opencv-in-swift\">my previous post</a>.</p>\n<h4><strong>Step 5</strong></h4>\n<p>Create a header file to use OpenCV.</p>\n<div class=\"gatsby-highlight\" data-language=\"objectivec\"><pre class=\"language-objectivec\"><code class=\"language-objectivec\"><span class=\"token comment\">// OpenCVTest-Briding-Header.h</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">import</span> &lt;Foundation/Foundation.h></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">import</span> &lt;UIKit/UIKit.h></span>\n\n<span class=\"token keyword\">@interface</span> ImageConverter <span class=\"token punctuation\">:</span> NSObject\n<span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>UIImage <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>ConvertImage<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span>UIImage <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>image<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">@end</span></code></pre></div>\n<h4><strong>Step 6</strong></h4>\n<p>Next, prepare the content of defined method.</p>\n<p>To use OpenCV, we have to write C++,\nso change the extension from m to mm.</p>\n<div class=\"gatsby-highlight\" data-language=\"objectivec\"><pre class=\"language-objectivec\"><code class=\"language-objectivec\"><span class=\"token comment\">// ImageConverter.mm</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">import</span> &lt;Foundation/Foundation.h></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">import</span> &lt;UIKit/UIKit.h></span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">import</span> \"OpenCVTest-Bridging-Header.h\"</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">import</span> &lt;opencv2/opencv.hpp></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">import</span> &lt;opencv2/imgcodecs/ios.h></span>\n\n<span class=\"token keyword\">@implementation</span> ImageConverter <span class=\"token punctuation\">:</span> NSObject\n\n<span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>UIImage <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>ConvertImage<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span>UIImage <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>image <span class=\"token punctuation\">{</span>\n    cv<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Mat mat<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">UIImageToMat</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> mat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    cv<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Mat gray<span class=\"token punctuation\">;</span>\n    cv<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">cvtColor</span><span class=\"token punctuation\">(</span>mat<span class=\"token punctuation\">,</span> gray<span class=\"token punctuation\">,</span> CV_RGB2GRAY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    cv<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Mat bin<span class=\"token punctuation\">;</span>\n    cv<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">threshold</span><span class=\"token punctuation\">(</span>gray<span class=\"token punctuation\">,</span> bin<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> cv<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>THRESH_BINARY <span class=\"token operator\">|</span> cv<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>THRESH_OTSU<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    UIImage <span class=\"token operator\">*</span>binImg <span class=\"token operator\">=</span> <span class=\"token function\">MatToUIImage</span><span class=\"token punctuation\">(</span>bin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> binImg<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">@end</span></code></pre></div>\n<h4><strong>Step 7</strong></h4>\n<p>Add some modifications to <code>ViewController.swift</code>\nto take a shot when tapping a button.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">import</span> <span class=\"token builtin\">UIKit</span>\n<span class=\"token keyword\">import</span> <span class=\"token builtin\">AVFoundation</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ViewController</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIViewController</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">AVCaptureVideoDataOutputSampleBufferDelegate</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token keyword\">var</span> taken<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token atrule\">@IBAction</span> <span class=\"token keyword\">func</span> <span class=\"token function\">take</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> sender<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token operator\">!</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>taken <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>taken <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>imageView<span class=\"token punctuation\">.</span>image <span class=\"token operator\">=</span> <span class=\"token builtin\">ImageConverter</span><span class=\"token punctuation\">.</span><span class=\"token function\">convert</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>imageView<span class=\"token punctuation\">.</span>image<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function\">captureOutput</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> captureOutput<span class=\"token punctuation\">:</span> <span class=\"token builtin\">AVCaptureOutput</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> didOutputSampleBuffer sampleBuffer<span class=\"token punctuation\">:</span> <span class=\"token builtin\">CMSampleBuffer</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span>\n                       from connection<span class=\"token punctuation\">:</span> <span class=\"token builtin\">AVCaptureConnection</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin\">DispatchQueue</span><span class=\"token punctuation\">.</span>main<span class=\"token punctuation\">.</span><span class=\"token function\">async</span><span class=\"token punctuation\">(</span>execute<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token operator\">!</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>taken <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">let</span> image<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIImage</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">CameraUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">imageFromSampleBuffer</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">:</span> sampleBuffer<span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>imageView<span class=\"token punctuation\">.</span>image <span class=\"token operator\">=</span> image<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4><strong>Step 8</strong></h4>\n<p>Well done!</p>\n<p>Let’s start your app and check it.</p>\n<p>If you can take a black-and-white picture as below,\nyour app works fine.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 568px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9eb320dd1f679f855aafb0fd37c49c3f/870c3/2016-11-07-black-and-white.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.33802816901409%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACA0lEQVQoz22Sy8vhYRTHf+7kMrlTotzKpZQUuS0oFoSJZCzcooxIKbLzL0wzGxsLO1lgSZKyVFNT7+ymeWcWs2WQ8ZLLb877+82YmZqzeHo6z/mcy/c8yOfVV/SKHg6H2+328PCxVquVy+VSqZTJZLLZbCqVeoVZNBqNxWI+ny+Xyz09PaEoCvHI+08fNuvv6/V6s9lcLhf0t53P5+PxCBdwXq9XuJ9Op+12iztxQ969eRt5GanX681ms1gsejyecDgciUSSySSUcrvdTqcTTqvVarPZlErlfD7HMz7D7XabTqe/wIzBYCAIolarvV6vXC4XiUTIX0YikeAcDod/4H6/r9FouFwumUxmMpkEAkGr1VosFrFYzGazwS8QCHg8HpVKhQCAR6MRNhQGd7tds9kMOuXzeYVCAc9w6vV6l8sllUqhKcjIYrHulXH42xqDF4sFTOVwOICpVqvj8bhSqUBZENZut0Nek8mkUqkkEgmfz7/DP44Y/Pj4JRAIlEqvZ7MZruF0OhUKhaFQCGTT6XSQCDqHEf4z82q1CgaDy+Xy7trtdrBVmBZG5XA4AIAQAENxGOEfeL/fw3doNBq9Xq/T6bRarUQiYTQaoUkajYbrDDCFQoGL3++HPcPaf+0ZPsNkMoE+8SA8mkgkQk0QTCaTGQwGECUej6fT6UKhMBgM7vBPtAws6G+EKbMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Black-and-white\"\n        title=\"Black-and-white\"\n        src=\"/static/9eb320dd1f679f855aafb0fd37c49c3f/870c3/2016-11-07-black-and-white.png\"\n        srcset=\"/static/9eb320dd1f679f855aafb0fd37c49c3f/00d96/2016-11-07-black-and-white.png 148w,\n/static/9eb320dd1f679f855aafb0fd37c49c3f/0b23c/2016-11-07-black-and-white.png 295w,\n/static/9eb320dd1f679f855aafb0fd37c49c3f/870c3/2016-11-07-black-and-white.png 568w\"\n        sizes=\"(max-width: 568px) 100vw, 568px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","frontmatter":{"title":"How to use OpenCV in Swift (2)","date":"November 07, 2016","tags":["Swift","OpenCV","Xcode"],"ogp":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2016/11/how-to-use-opencv-in-swift-2","previous":{"fields":{"slug":"/2016/11/how-to-use-opencv-in-swift"},"frontmatter":{"title":"How to use OpenCV in Swift (1)","tags":["Swift","OpenCV","Xcode"]}},"next":{"fields":{"slug":"/2016/11/q-learning"},"frontmatter":{"title":"Q Learning","tags":["JavaScript","Machine Learning"]}}}}}